<!-- 
    The admin_profile.ejs file contains information
    related to the admin privileges and profile in
    the Team Aptiv web application. JavaScript is 
    included in the EJS file to alert the admin of 
    certain events that may occur while they are 
    using the application. The file also lists out
    the admin's profile information, the events that
    the admin has signed up for, buttons for the admin
    to create events, and buttons for the admin to 
    manipulate or view user information.
    ...
    Project: Aptiv Web Application
    Authors: Andrew Krause, Riley Radle, 
    Anthony Musbach, Zach Gephart
    Class: Software Design IV (CS 341)
    Group: #2
    Date: 12/15/2021
    ...
-->

<!-- IN EVENT HISTORY, SHOW THE EVENTS THAT THE ADMIN HAS CANCELLED!!! -->

<%- include('./partials/home_header.ejs') %>

    <div class="profile-ejs">
        <!-- Create a card for showing the ADMIN data -->
        <div class="container w-75 mt-3">
            <div class="row">

                <div class="col">
                    <header>
                        <!-- Display user profile picture; if ADMIN did -->
                        <!-- not use OAuth to sign or does not have picture, -->
                        <!-- use default profile image -->
                        <form action="/user_profile" method="post">
                            <img id="profileImage" src=<%= user.picture %> alt="Image not Found" onerror=this.src="images/default_pic.png">
                        </form>

                        <!-- Display ADMIN name and ADMIN status -->
                        <div>
                            <h1><%= user.firstName %> <%= user.lastName %></h1>
                            <p>Status: <%= user.status %></p>
                            <p>Given Donations: $<%= user.givenDonations %></p>
                        </div>
                    </header>

                    <!-- Obtain an array of identification numbers in order to list all of the -->
                    <!-- events that the ADMIN has has signed up for under the "Events" button -->
                    <% var eventsArrayIds = []; %>
                    <% listOfUserEvents.forEach(function(event) { %>
                        <% if(event == null) { %>
                            <% // For now, do nothing. In the future, trigger a request so that the %>
                            <% // event object ID is removed from the ADMIN's info in the database. %>
                        <% } else { %>
                            <% eventsArrayIds.push(event.eventID); %>
                        <% } %>
                    <% }); %>

                    <!-- Create a div to contain the buttons on the ADMIN profile -->
                    <div class="profile-options">

                        <!-- Add a button so that the ADMIN can see what events they have signed up for -->
                        <button type="button" data-bs-toggle="collapse" data-bs-target="#collapse-events" aria-expanded="false" aria-controls="collapse-events">
                            <i class="fas fa-clipboard-list"></i>
                            My Events
                            <i class="fas fa-chevron-right"></i>
                        </button>

                        <!-- Add a button so that the ADMIN can see the users of the site !!! IMPLEMENT THIS SOON -->
                        <form action="" method="">
                            <button type="submit" class="btn">
                                <i class="fas fa-users"></i>
                                See Users
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </form>

                         <!-- Add a button so that the ADMIN can create a new event -->
                         <form action="/create_event" method="POST">
                            <button type="submit">
                                <i class="fas fa-calendar-plus"></i>
                                Create New Event
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </form>
                            
                        <!-- Add a button for the ADMIN to see their history !!! THIS WILL BE LATER ON IN THE COURSE -->
                        <form action="" method="">
                            <button type="submit" class="btn">
                                <i class="fas fa-history"></i>
                                See Event History
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </form>

                        <!-- Add a button so that the ADMIN can logout of their account -->
                        <form action="/logout" method="POST">
                            <button type="submit">
                                <i class="fas fa-sign-out-alt"></i>
                                Logout
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- Add a column class in order to help make the page responsive -->
                <div class="col">

                    <!-- 
                        Include EJS to display any success messages to the ADMIN if they
                        have successfully cancelled one event or multiple event timeslots.
                    -->
                    <% if(sucessCancelled.length > 0) { %>
                        <div class="confirmation">
                            <div class="elementToFadeInAndOut message-format">
                                <h1><%= sucessCancelled %></h1>
                            </div>
                        </div>
                    <% } %>

                    <!-- 
                        Include EJS to display a success message to the ADMIN if
                        they successfully created a new event.
                    -->
                    <% if(successCreated.length > 0) { %>
                        <div class="card-body elementToFadeInAndOut message-format">
                            <h1 class="confirmation"><%= successCreated %></h1>
                        </div>
                    <% } %>

                    <!-- 
                        Include EJS to display a failure message to the ADMIN if
                        they failed to create a new event.
                    -->
                    <% if(failureNotCreated.length > 0) { %>
                            <div class="card-body elementToFadeInAndOut message-format">
                                <h1 class="incorrect-input"><%= failureNotCreated %></h1>
                            </div>
                    <% } %>
                        
                    <!-- 
                        Include a section for the events that the ADMIN has signed up
                        for to be rendered on the user's profile page
                    -->
                    <div class="events-list collapse" id="collapse-events"> 
                        <!-- collapse collapse" id="collapseEvents"> -->
                        <!-- Loop through the database and display the events -->
                        <% listOfUserEvents.forEach(function(event) { %>
                            <% if(event == null) { %>
                                <% // For now, do nothing. In the future, trigger a request so that the %>
                                <% // event object ID is removed from the ADMIN's info in the database. %>
                            <% } else { %>

                                <div class="event">
                                    <!-- Create divs that will make the events be collapsable -->
                                    <button class="dropdown" type="button" data-bs-toggle="collapse" data-bs-target="#collapse<%=event._id%>"
                                    aria-expanded="false" aria-controls="collapse<%=event._id%>"><%= event.eventName %></button>

                                    <div class="collapse" id="collapse<%=event._id%>">
                                        <!-- Include a function to simplify the date display -->
                                        <% function simplifyEventDate(eventDate){ %>
                                            <% // First split the event into the components that directly %>
                                            <% // involve the numberical representations of a date. %>
                                            <% var date = eventDate.toISOString().split("T")[0]; %>
                                        
                                            <% // Create variables for workring with %>
                                            <% // the nubmers in the date variable. %>
                                            <% var arrayDate = date.split('-'); %>
                                            <% var day = arrayDate[2]; %>
                                            <% var getMonth = arrayDate[1]; %>
                                            <% var month = ""; %>
                                            <% var year = arrayDate[0]; %>
                                            <% var simplifiedDate = ""; %>
                                        
                                            <% // Use a series of conditionals to determine %>
                                            <% // what the name of the month is based on the %>
                                            <% // numerical representation of it. %>
                                            <% if(getMonth.localeCompare('1') == 0) { %>
                                                <% month = 'Jan'; %>
                                            <% } else if(getMonth.localeCompare('2') == 0) { %>
                                                <% month = 'Feb'; %>
                                            <% } else if(getMonth.localeCompare('3') == 0) { %>
                                                <% month = 'Mar'; %>
                                            <% } else if(getMonth.localeCompare('4') == 0) { %>
                                                <% month = 'Apr'; %>
                                            <% } else if(getMonth.localeCompare('5') == 0) { %>
                                                <% month = 'May'; %>
                                            <% } else if(getMonth.localeCompare('6') == 0) { %>
                                                <% month = 'Jun'; %>
                                            <% } else if(getMonth.localeCompare('7') == 0) { %>
                                                <% month = 'Jul'; %>
                                            <% } else if(getMonth.localeCompare('8') == 0) { %>
                                                <% month = 'Aug'; %>
                                            <% } else if(getMonth.localeCompare('9') == 0) { %>
                                                <% month = 'Sep'; %>
                                            <% } else if(getMonth.localeCompare('10') == 0) { %>
                                                <% month = 'Oct'; %>
                                            <% } else if(getMonth.localeCompare('11') == 0) { %>
                                                <% month = 'Nov'; %>
                                            <% } else if(getMonth.localeCompare('12') == 0) { %>
                                                <% month = 'Dec'; %>
                                            <% } else { %>
                                                <% month = 'ERROR'; %>
                                            <% } %>
                                        
                                            <% // Create the simplified date and return it. %>
                                            <% simplifiedDate = month + " " + day + ", " + year; %>
                                            <% return simplifiedDate; %>
                                        <% } %>

                                        <ul class="mt-1">
                                            <!-- The date displayed utilized the function above for simplification -->
                                            <li> <%= simplifyEventDate(event.eventDate) %> </li>

                                            <!-- Display the event location, description, volunteer, and donation information -->
                                            <li>Location: <%= event.eventLocation %> </li>

                                            <!-- If description is empty, do not display the description -->
                                            <!-- Use the split function to determine if the description was left blank -->
                                            <% var descriptionArray = event.eventDescription.split(" "); %>
                                            <% if(descriptionArray[1] != "") { %>

                                                <!-- If the description is not blank, obtain the info for it and display -->
                                                <% var descriptionString = ""; %>
                                                <% for(let i = 1; i < descriptionArray.length; i++) { %>
                                                    <% descriptionString = descriptionString + " " + descriptionArray[i]; %>
                                                <% } %>
                                                
                                                <!-- Display the description assuming it is not blank -->
                                                <li>Description: <%= descriptionString %></li>
                                            <% } %>

                                            
                                            <!-- THIS IS WHERE YOU WERE PLANNING ON LISTING HOW MUCH A USER HAD DONATED TO AN EVENT!!! -->


                                            <!-- Check if the ADMIN has times that they signed up for in the event. List the times out -->
                                            <% if(user.timesAttending.length > 1) { %>
                                                <li>Times Attending: </li>

                                                <!-- FUNCTION: Function to get the value of the time attending -->
                                                <% function getResult() { %>
                                                    <% var value = $('timeattending').getValue(); %>
                                                <% } %>

                                                <!-- Makes POST request to the event cancellation route -->
                                                <form class="form-horizontal" action="/cancel_event" method="POST">
                                                    <!-- Create a counter variable that tracks the number of timeslots in each event a user has signed up for -->
                                                    <% var numTimeSlots = 0; %>

                                                    <ol>
                                                        <!-- Create different time slots that the ADMIN can cancel -->
                                                        <% user.timesAttending.forEach(function(timesAttendingEvent) { %>

                                                            <% // Take the time attending and remove the unique id from the total string for display purposes. %>
                                                            <% var timeAttendanceSplitTemp = timesAttendingEvent.split(" "); %>

                                                            <% // If the length of the split is greater than 1, the time attending is not an id alone. %>
                                                            <% if(timeAttendanceSplitTemp.length > 1) { %>
                                                                
                                                                <% // Create variables to store the time attendance information: %>
                                                                <% // The id attached to the time attendance and the time range itself. %>
                                                                <% var timeAttendanceIentifier = timeAttendanceSplitTemp[3]; %> <% // --> MAY NOT NEED THIS!!! %>
                                                                <% var timeAttendance = timeAttendanceSplitTemp[4] + " " + timeAttendanceSplitTemp[5] + " " + timeAttendanceSplitTemp[6] + " " + timeAttendanceSplitTemp[7] + " " + timeAttendanceSplitTemp[8]; %>

                                                                <% // If the time being attended matches the event it was from, render it %>
                                                                <% // within the correct event section in the user profile. %>
                                                                <% if(event.eventID == timeAttendanceIentifier) { %>
                                                                    <% // Display the time attending as a checkbox that the user can select. %>
                                                                    <li>
                                                                        <input type="checkbox" id="<%= timeAttendance %>" name="timeattending" value="<%= timesAttendingEvent %>">
                                                                        <label for="<%= timeAttendance %>"> <%= timeAttendance %> </label>
                                                                    </li>
                                                                    <% numTimeSlots += 1; %>
                                                                <% } %>

                                                            <% } %>

                                                        <% }); %>
                                                    </ol>

                                                    <!-- Create hidden input types to obtain the different values that will be processed by the server -->
                                                    <input type="hidden" id="customId" name="eventidentifier" value="<%= event._id %>" onChange="getResult()">
                                                    <input type="hidden" id="customId" name="timeattendlength" value="<%= numTimeSlots %>" onChange="getResult()">
                                                    <button type="submit" class="mt-4 btn btn-lg btn-outline-light">Cancel Time(s)</button>
                                                </form>
                                            <% } %>
                                        </ul>
                                    </div>
                                </div>                                
                            <% } %>
                        <% }); %>
                    </div>
                </div>
            </div>
        </div>
    </div>

<%- include('./partials/footer.ejs') %>