<!-- 
    DESCRIPTION GOES HERE...
    ...
    Author: Andrew Krause, Riley Radle, Anthony Musbach, Zach Gephart
    Date: TBD
    ...
-->

<%- include('./partials/home_header.ejs') %>

    <!-- 
        Include EJS to display any error messages to the user if the
        attempt to access a page that they are not authorized to access.
    -->
    <% if(permissionDenied.length > 0) { %>
        <div class="card">
            <div class="card-body elementToFadeInAndOut message-format">
                <h1 class="incorrect-input"><%= permissionDenied %></h1>
            </div>
        </div>
    <% } %>

    <!-- Create a card for showing the user data -->
    <div class="container mt-5 mb-5">
        <div class="row register-page-format">
            <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12 mx-auto">
                <div class="card">
                    <div class="card-body">

                        <!-- Display user profile picture; if user did -->
                        <!-- not use OAuth to sign or does not have picture, -->
                        <!-- use default profile image -->
                        <form action="/user_profile" method="post">
                            <div class="mt-3 mb-3" id="profile-container">
                                <img id="profileImage" src=<%= user.picture %> alt="Image not Found" onerror=this.src="images/default_pic.png">
                            </div>
                        </form>

                        <!-- Display user name and status -->
                        <header>
                            <h1 class="black-text">Welcome,&nbsp;<%= user.firstName %>.</h1>
                            <p>Status: Volunteer</p>
                        </header>
                
                        <!-- Create a div for two inline buttons in the user profile -->
                        <div class="mt-4 mb-4 btn-group d-flex special" role="group" aria-label="...">
                            
                            <!-- Add a button for the user to find events -->
                            <div>
                                <form action="/find_events" method="POST">
                                    <div class="inner">
                                        <button type="submit" class="btn btn-outline-dark btn-block w-100">All Events</button>
                                    </div>
                                </form>
                            </div>
                            
                            <!-- Add a button for the user to see their history -->
                            <div>
                                <form action="" method=""> <!-- ADD A LINK TO THIS LATER!!! -->
                                    <div class="inner">
                                        <button type="submit" class="btn btn-outline-dark btn-block w-100">Event History</button>
                                    </div>
                                </form>
                            </div>

                        </div>
                    </div>

                    <!-- List out all of the events that the user has signed up for or donated to here -->
                    <h3>My Events</h3>

                    <!-- 
                        Include a section for the events that the user has signed up
                        for to be rendered on the user's profile page
                    -->
                    <section class="event-list">
                        <!-- Loop through the database and display the events -->
                        <% listOfUserEvents.forEach(function(event) { %>
                            <% if(event == null) { %>
                                <% // For now, do nothing. In the future, trigger a request so that the %>
                                <% // event object ID is removed from the user's info in the database. %>
                            <% } else { %>
                                <a href="/events/<%=event._id%>">
                                    <div class="card">
                                        <div class="card-body">
                                            <div class="event">
                                                <h2 class="black-text"> <%= event.eventName %> </h2>

                                                <!-- Include a function to simplify the date display -->
                                                <% function simplifyEventDate(eventDate){ %>

                                                    <% // First split the event into the components that directly %>
                                                    <% // involve the numberical representations of a date. %>
                                                    <% var date = eventDate.toISOString().split("T")[0]; %>
                                                
                                                    <% // Create variables for workring with %>
                                                    <% // the nubmers in the date variable. %>
                                                    <% var arrayDate = date.split('-'); %>
                                                    <% var day = arrayDate[2]; %>
                                                    <% var getMonth = arrayDate[1]; %>
                                                    <% var month = ""; %>
                                                    <% var year = arrayDate[0]; %>
                                                    <% var simplifiedDate = ""; %>
                                                
                                                    <% // Use a series of conditionals to determine %>
                                                    <% // what the name of the month is based on the %>
                                                    <% // numerical representation of it. %>
                                                    <% if(getMonth.localeCompare('1') == 0) { %>
                                                        <% month = 'Jan'; %>
                                                    <% } else if(getMonth.localeCompare('2') == 0) { %>
                                                        <% month = 'Feb'; %>
                                                    <% } else if(getMonth.localeCompare('3') == 0) { %>
                                                        <% month = 'Mar'; %>
                                                    <% } else if(getMonth.localeCompare('4') == 0) { %>
                                                        <% month = 'Apr'; %>
                                                    <% } else if(getMonth.localeCompare('5') == 0) { %>
                                                        <% month = 'May'; %>
                                                    <% } else if(getMonth.localeCompare('6') == 0) { %>
                                                        <% month = 'Jun'; %>
                                                    <% } else if(getMonth.localeCompare('7') == 0) { %>
                                                        <% month = 'Jul'; %>
                                                    <% } else if(getMonth.localeCompare('8') == 0) { %>
                                                        <% month = 'Aug'; %>
                                                    <% } else if(getMonth.localeCompare('9') == 0) { %>
                                                        <% month = 'Sep'; %>
                                                    <% } else if(getMonth.localeCompare('10') == 0) { %>
                                                        <% month = 'Oct'; %>
                                                    <% } else if(getMonth.localeCompare('11') == 0) { %>
                                                        <% month = 'Nov'; %>
                                                    <% } else if(getMonth.localeCompare('12') == 0) { %>
                                                        <% month = 'Dec'; %>
                                                    <% } else { %>
                                                        <% month = 'ERROR'; %>
                                                    <% } %>
                                                
                                                    <% // Create the simplified date and return it. %>
                                                    <% simplifiedDate = month + " " + (day - 1) + ", " + year; %>
                                                    <% return simplifiedDate; %>
                                                <% } %>
                                                
                                                <!-- The date displayed utilized the function above for simplification -->
                                                <p> <%= simplifyEventDate(event.eventDate) %> </p>
                                                <p> <%= event.eventLocation %> </p>
                                            </div>
                                        </div>
                                    </div>
                                </a>
                            <% } %>
                        <% }); %>
                    </section>

                    <!-- Include a button for going back to the "Events" page -->
                    <div class="btn-group p-2">
                        <!-- Back button -->
                        <div class="d-flex">
                            <form action="/back" method="POST">
                                <div>
                                    <button type="submit" class="btn btn-outline-dark btn-back"><i class="fas fa-arrow-left"></i> Back</button>
                                </div>
                            </form>
                        </div>

                        <!-- Logout button -->
                        <div class="">
                            <form action="/logout" method="POST">
                                <div>
                                    <button type="submit" class="btn btn-outline-dark btn-logout">Logout</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<%- include('./partials/footer.ejs') %>
